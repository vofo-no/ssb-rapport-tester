/*! ssb-rapport-tester 2015-12-15 */
(function(){$(function(){var a,b,c,d,e,f,g,h,i,j,k,l;return a=(new Date).getFullYear(),(new Date).getMonth()<4&&a--,$("h1").text($("h1").text()+" "+a),b=0,j=0,i=-1,e=function(){return b=0,j=0,i=-1},window.uploadData={rows:[],errors:[],reset:function(){return window.uploadData.rows=[],window.uploadData.errors=[],e(),window.Worker?l.postMessage([!1]):validatorInit()}},g=function(a){return $("#analyzeStatus").text(a||"Ingen fil er valgt")},g(),h=function(){var a,b,e,f,g,h,i,k;if($("#success, #errors").hide(),window.uploadData.errors.length){for($("#errors tbody").empty(),h=window.uploadData.errors,e=0,g=h.length;g>e;e++){for(a=h[e],k=$("<tr />"),b=f=1,i=a.length;i>=1?i>f:f>i;b=i>=1?++f:--f)28>b&&k.append(d(a[b],a[0][b-2]));k.append(d(c(a[0]),!0)),$("#errors tbody").append(k)}return $("#errors").show()}return j>0?$("#success").fadeIn():void 0},h(),f=function(){return i>-1&&j+b===i?(h(),$("#analyzeStatus2").text("Ferdig! Antall gyldige rader: "+j+" - antall med feil: "+b)):$("#analyzeStatus2").text("Analyserer... ("+Math.round((j+b)/i*100)+" %) Antall gyldige rader: "+j+" - antall med feil: "+b)},d=function(a,b){return $("<td />").append(a).addClass(b?"danger":"success")},c=function(a){var b,c,d;d=$("<ul />");for(b in a)c=d.append($("<li />").text(a[b]));return d},$("#fileInput").on("change",function(a){var b;if(void 0!==a.target.files[0])return window.uploadData.reset(),b=0,g("Leser fil..."),$("#fileInput").prop("disabled",!0),Papa.parse(a.target.files[0],{dynamicTyping:!0,worker:!0,skipEmptyLines:!0,step:function(a){return b++,k(a.data[0],b)},complete:function(){return g("Fil innlest. Fant "+b+" rader."),$("#fileInput").prop("disabled",!1),i=b,window.Worker?void 0:f()}})}),l=new Worker(VALIDATOR_WORKER),window.Worker&&(l.onerror=function(a){return console.log(a)},l.onmessage=function(a){return a.data[0]?(j++,window.uploadData.rows.push(a.data[1])):(b++,window.uploadData.errors.push(a.data[1])),f()}),k=function(a,c){var d;return window.Worker?l.postMessage([a,c]):(d=validateRow(a,c),d[0]?(j++,window.uploadData.rows.push(d[1])):(b++,window.uploadData.errors.push(d[1])),f())}})}).call(this);